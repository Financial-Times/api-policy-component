Policy Component
================

An HTTP service provides a facade over the reader endpoint for use by licenced partners.

* adds calculated fields for use by B2B partners
* blocks or hides content that is not permitted to the partner
* rewrites queries according to account configuration

Because we plan to implement caching, this component is generally deployed with Varnish
between it and the actual reader endpoints. Therefore, for clarity, the reader endpoint
configuration options are called the Varnish configuration options.

INTERFACE
=========

This facade deliberately does not define it's own set of endpoints or interface contracts
instead it makes specific modifications to the interface of the Reader API and has
minimal knowledge of them.

Header Handling
===============

In general, headers are passed from the gateway through the facade to the Varnish layer.
Varnish is expected to perform a similar forwarding of headers with the result that headers
seen here are seen at the reader API.

The following headers are exceptions, they all related directly to the underlying TCP
connection and the encoding of data over it.  Since each leg of the request workflow is a
separate connection to a new host, these header are not forwarded from one TCP connection to the
next but will likely be regenerated by local libraries (e.g. Jersey Client, Jetty).

* "Host" - Seen in requests this names the host you intend to connect to.

* "Connection" - Seen in responses this signals to the client that the TCP connection will be
  kept alive or closed.

* "Accept-Encoding" - Seen in requests this signals that GZip is or is not supported by the client.

* "Content-Length" - Seen in responses. Gives the length of the entity. We strip this and let the
  platform regenerate it because it is subject to change.

* "Transfer-Encoding" the opposite number to Accept-Encoding.

* Date - We remove this and regenerate it as a hacky way to avoid having two in our response -
  the platform was adding a second value. Since we are modifying responses it is not inaccurate
  to bump the date by a few milliseconds.